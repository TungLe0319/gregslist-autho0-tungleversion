let Auth0Provider,accountService;_d5f‍.x([["AccountValidator",()=>AccountValidator]]);_d5f‍.w("@bcwdev/auth0provider",[["Auth0Provider",["Auth0Provider"],function(v){Auth0Provider=v}]]);_d5f‍.w("../services/AccountService",[["accountService",["accountService"],function(v){accountService=v}]]);


       async function AccountValidator(req, res, next) {
  try {
    const bearer = req.headers.Authorization || req.headers.authorization
    if (!bearer) {
      return next()
    }
    const userInfo = await Auth0Provider.getUserInfoFromBearerToken(bearer)
    if (!userInfo.id) {
      throw new Error('[MISSING_AUTH0_RULE] Unable to create account: Missing Extend UserInfo rule in Auth0 account')
    }
    req.account = await accountService.getAccount(userInfo)
    next()
  } catch (e) {
    next(e)
  }
}
